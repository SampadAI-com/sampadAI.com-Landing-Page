<!DOCTYPE html>
<html lang="<%= language %>">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= messages[language].title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Language Switcher Dropdown -->
        <% if (language !== 'en') { %>
        <div class="language-switcher">
            <div class="dropdown">
                <button class="dropdown-toggle" onclick="toggleDropdown()">
                    <%= language.toUpperCase() %>
                    <span class="dropdown-arrow">â–¼</span>
                </button>
                <div class="dropdown-menu" id="languageDropdown">
                    <a href="/<%= language %>" class="dropdown-item current">
                        <%= language.toUpperCase() %>
                    </a>
                    <a href="/en" class="dropdown-item">
                        EN
                    </a>
                </div>
            </div>
        </div>
        <% } %>
        
        <div class="coming-soon-content">
            <h1 class="title"><%= messages[language].title %></h1>
            <p class="tagline"><%= messages[language].tagline %></p>
            <h2 class="coming-soon"><%= messages[language].comingSoon %></h2>
            <p class="description"><%= messages[language].description %></p>
            
            <form class="waitlist-form" action="/waitlist" method="POST">
                <div class="form-group">
                    <input 
                        type="email" 
                        name="email" 
                        placeholder="<%= messages[language].emailPlaceholder %>" 
                        required 
                        class="email-input"
                    >
                    <button type="submit" class="join-button">
                        <%= messages[language].joinWaitlist %>
                    </button>
                </div>
            </form>
            
            <div class="success-message" id="successMessage" style="display: none;">
                <%= messages[language].successMessage %>
            </div>
        </div>
    </div>

    <script>
        // Dropdown functionality
        function toggleDropdown() {
            const dropdown = document.getElementById('languageDropdown');
            dropdown.classList.toggle('show');
        }
        
        // Close dropdown when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.dropdown-toggle')) {
                const dropdowns = document.getElementsByClassName('dropdown-menu');
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }
        
        // Waitlist form handling
        document.querySelector('.waitlist-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = this.querySelector('input[name="email"]').value;
            const successMessage = document.getElementById('successMessage');
            const submitButton = this.querySelector('button[type="submit"]');
            
            // Show loading state
            submitButton.textContent = 'Joining...';
            submitButton.disabled = true;
            
            try {
                // Submit to backend
                const response = await fetch('/waitlist', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Show success message
                    this.style.display = 'none';
                    successMessage.style.display = 'block';
                } else {
                    throw new Error(result.message || 'Failed to join waitlist');
                }
            } catch (error) {
                console.error('Waitlist error:', error);
                // Reset button state
                submitButton.textContent = '<%= messages[language].joinWaitlist %>';
                submitButton.disabled = false;
                alert('Failed to join waitlist. Please try again.');
            }
        });
    </script>
</body>
</html>
